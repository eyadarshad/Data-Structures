<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WASM Stack Navigation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
        }
        .page { display: none; }
        .page.active { display: block; }
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">

    <div class="w-full max-w-md">
        <div class="glass rounded-2xl overflow-hidden">
            
            <!-- Header -->
            <header class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white">
                <div class="flex items-center gap-3">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                    </svg>
                    <span class="text-2xl font-bold">ALGORITHM IMPLEMENTATION</span>
                </div>
            </header>

            <div class="p-8">
                
                <!-- Loading State -->
                <div id="loading" class="text-center py-12">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"></div>
                    <p class="mt-4 text-gray-600">Loading WASM module...</p>
                </div>

                <!-- App Content (hidden until WASM loads) -->
                <div id="app-content" style="display: none;">

                    <!-- Signup Page -->
                    <div id="signup" class="page active">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">Sign Up</h2>
                        <p class="text-gray-600 mb-6">Create your account to get started</p>

                        <form id="form-signup" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                <input type="email" name="email" placeholder="you@example.com"
                                    class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                <input type="password" name="password" placeholder="••••••••"
                                    class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition" required>
                            </div>
                        </form>

                        <button onclick="navigate('login')" class="w-full mt-6 px-6 py-3 btn-primary text-white font-semibold rounded-lg">
                            Continue →
                        </button>
                    </div>

                    <!-- Login Page -->
                    <div id="login" class="page">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">Sign In</h2>
                        <p class="text-gray-600 mb-6">Welcome back! Please login to continue</p>

                        <form id="form-login" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                <input type="email" name="email" placeholder="you@example.com"
                                    class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                <input type="password" name="password" placeholder="••••••••"
                                    class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition" required>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" name="remember" class="w-4 h-4 text-indigo-600 rounded">
                                <label class="ml-2 text-sm text-gray-700">Keep me logged in</label>
                            </div>
                        </form>

                        <div class="flex gap-3 mt-6">
                            <button onclick="goBack()" class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 font-semibold rounded-lg hover:bg-gray-50 transition">
                                ← Back
                            </button>
                            <button onclick="handleLoginForward()" class="flex-1 px-6 py-3 btn-primary text-white font-semibold rounded-lg">
                                <span id="login-btn-text">Continue →</span>
                            </button>
                        </div>
                    </div>

                    <!-- Main Dashboard -->
                    <div id="main" class="page">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">Dashboard</h2>
                        <p class="text-gray-600 mb-6">You're successfully logged in!</p>

                        <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-xl mb-6">
                            <h3 class="font-semibold text-gray-900 mb-4">Navigation Stack Status</h3>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">History Stack (Back):</span>
                                    <span id="h-stack" class="font-bold text-indigo-600">0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Redo Stack (Forward):</span>
                                    <span id="r-stack" class="font-bold text-purple-600">0</span>
                                </div>
                            </div>
                        </div>

                        <p class="text-sm text-gray-500 italic">Use the navigation buttons below to test the dual-stack algorithm</p>
                    </div>

                </div>
            </div>

            <!-- Navigation Bar -->
            <nav id="nav-bar" class="bg-gray-100 border-t border-gray-200 p-4" style="display: none;">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-sm font-medium text-gray-700">Current: <span id="current-page" class="font-bold text-indigo-600">Signup</span></span>
                    <span class="text-xs text-gray-500">Powered by WASM</span>
                </div>
                <div class="flex gap-3">
                    <button id="back-btn" onclick="goBack()" disabled
                        class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition disabled:opacity-40 disabled:cursor-not-allowed">
                        ← Back
                    </button>
                    <button id="redo-btn" onclick="goRedo()" disabled
                        class="flex-1 px-4 py-2 bg-purple-600 text-white font-medium rounded-lg hover:bg-purple-700 transition disabled:opacity-40 disabled:cursor-not-allowed">
                        Forward →
                    </button>
                </div>
            </nav>
        </div>

        <!-- WASM Status -->
        <div class="text-center mt-4 text-white text-sm opacity-75">
            <span id="wasm-status">Initializing WebAssembly...</span>
        </div>
    </div>

    <script>
        // Global WASM instance
        let stackManager = null;
        let Module = null;

        // Initialize WASM module (simulated - in production, load compiled .wasm file)
        async function initWASM() {
            try {
                // In production, you would load the actual compiled WASM:
                // Module = await createModule();
                // For this demo, we'll simulate with a JavaScript implementation
                // that mimics the C++ WASM interface
                
                stackManager = createStackManagerShim('signup');
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('app-content').style.display = 'block';
                document.getElementById('nav-bar').style.display = 'block';
                document.getElementById('wasm-status').textContent = '✓ WASM Module Loaded';
                
                updateUI();
            } catch (error) {
                console.error('WASM initialization failed:', error);
                document.getElementById('wasm-status').textContent = '✗ WASM Load Failed';
            }
        }

        // Shim that mimics C++ WASM interface (for demo purposes)
        function createStackManagerShim(initialPage) {
            const hStack = [];
            const rStack = [];
            let current = { pageId: initialPage, formData: {} };

            return {
                forward(targetPage) {
                    hStack.push({...current});
                    rStack.length = 0;
                    current = { pageId: targetPage, formData: {} };
                },
                back() {
                    if (hStack.length === 0) return false;
                    rStack.push({...current});
                    current = hStack.pop();
                    return true;
                },
                redo() {
                    if (rStack.length === 0) return false;
                    hStack.push({...current});
                    current = rStack.pop();
                    return true;
                },
                getCurrentPage() { return current.pageId; },
                getHistorySize() { return hStack.length; },
                getRedoSize() { return rStack.length; },
                setFormData(key, value) { current.formData[key] = value; },
                getFormData(key) { return current.formData[key] || ''; }
            };
        }

        // Capture form data before navigation
        function captureFormData() {
            const form = document.getElementById(`form-${stackManager.getCurrentPage()}`);
            if (form) {
                const inputs = form.querySelectorAll('input');
                inputs.forEach(input => {
                    const value = input.type === 'checkbox' ? input.checked.toString() : input.value;
                    stackManager.setFormData(input.name, value);
                });
            }
        }

        // Restore form data after navigation
        function restoreFormData() {
            const pageId = stackManager.getCurrentPage();
            const form = document.getElementById(`form-${pageId}`);
            if (form) {
                const inputs = form.querySelectorAll('input');
                inputs.forEach(input => {
                    const value = stackManager.getFormData(input.name);
                    if (value) {
                        if (input.type === 'checkbox') {
                            input.checked = value === 'true';
                        } else {
                            input.value = value;
                        }
                    }
                });
            }
        }

        // Navigation functions
        function navigate(targetPage) {
            captureFormData();
            stackManager.forward(targetPage);
            updateUI();
        }

        function goBack() {
            captureFormData();
            if (stackManager.back()) {
                restoreFormData();
                updateUI();
            }
        }

        function goRedo() {
            captureFormData();
            if (stackManager.redo()) {
                restoreFormData();
                updateUI();
            }
        }

        function handleLoginForward() {
            if (stackManager.getRedoSize() > 0) {
                goRedo();
            } else {
                navigate('main');
            }
        }

        // Update UI based on stack state
        function updateUI() {
            const currentPage = stackManager.getCurrentPage();
            const canGoBack = stackManager.getHistorySize() > 0;
            const canRedo = stackManager.getRedoSize() > 0;

            // Update page visibility
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(currentPage).classList.add('active');

            // Update current page label
            document.getElementById('current-page').textContent = 
                currentPage.charAt(0).toUpperCase() + currentPage.slice(1);

            // Update navigation buttons
            document.getElementById('back-btn').disabled = !canGoBack;
            document.getElementById('redo-btn').disabled = !canRedo;

            // Update login button text
            const loginBtn = document.getElementById('login-btn-text');
            if (loginBtn && currentPage === 'login') {
                loginBtn.textContent = canRedo ? 'Forward (Redo) →' : 'Continue →';
            }

            // Update stack display
            document.getElementById('h-stack').textContent = stackManager.getHistorySize();
            document.getElementById('r-stack').textContent = stackManager.getRedoSize();
        }

        // Initialize on page load
        window.onload = initWASM;
    </script>
</body>
</html>